<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrum Master Pro - Quiz Certification Agile avec Tableau des Scores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Firebase SDK (Compat Version) -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Spline 3D Background -->
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.12.39/build/spline-viewer.js"></script>
    
    <style>
        :root {
            --primary: #4A6FFF;
            --primary-dark: #3A5CE8;
            --secondary: #FF6B9D;
            --accent: #00D4AA;
            --accent-dark: #00B894;
            --dark: #1A1F3C;
            --dark-light: #2A2F5C;
            --light: #F8FAFF;
            --success: #00D4AA;
            --warning: #FFA726;
            --danger: #FF6B9D;
            --gradient-bg: linear-gradient(135deg, #1A1F3C 0%, #2A2F5C 50%, #3A3F7C 100%);
            --gradient-primary: linear-gradient(135deg, #4A6FFF 0%, #3A5CE8 100%);
            --gradient-accent: linear-gradient(135deg, #00D4AA 0%, #00B894 100%);
            --gradient-secondary: linear-gradient(135deg, #FF6B9D 0%, #FF4773 100%);
            --gradient-gold: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            --gradient-silver: linear-gradient(135deg, #C0C0C0 0%, #A0A0A0 100%);
            --gradient-bronze: linear-gradient(135deg, #CD7F32 0%, #B76E2A 100%);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-heavy: 0 20px 50px rgba(0, 0, 0, 0.3);
            --radius: 20px;
            --radius-sm: 10px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            background: transparent;
        }

        /* Spline 3D Background Container */
        .spline-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .spline-background spline-viewer {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Overlay sombre pour am√©liorer la lisibilit√© */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(26, 31, 60, 0.85) 0%, 
                rgba(42, 47, 92, 0.8) 50%, 
                rgba(58, 63, 124, 0.75) 100%);
            z-index: -1;
            backdrop-filter: blur(2px);
        }

        /* Particules d'arri√®re-plan (optionnel) */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header avec navigation */
        header {
            padding: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 20px 30px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: var(--shadow);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .logo-text h1 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
        }

        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Navigation et profil utilisateur */
        .user-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 500;
            font-size: 1rem;
        }

        .user-score {
            background: var(--gradient-accent);
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .btn-nav {
            padding: 12px 25px;
            border: none;
            border-radius: var(--radius-sm);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-nav:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        .btn-nav.active {
            background: var(--gradient-primary);
            border-color: var(--primary);
        }

        /* √âcrans principaux */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* √âcran de connexion */
        .login-container {
            max-width: 500px;
            margin: 50px auto;
            text-align: center;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 50px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
        }

        .login-icon {
            font-size: 4rem;
            margin-bottom: 30px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .login-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .login-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn-login {
            padding: 18px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .btn-login::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn-login:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(40, 40);
                opacity: 0;
            }
        }

        .btn-google {
            background: white;
            color: #333;
        }

        .btn-google:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.2);
        }

        .btn-guest {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-guest:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary);
        }

        .login-features {
            margin-top: 40px;
            text-align: left;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature i {
            color: var(--accent);
            font-size: 1.5rem;
            width: 40px;
        }

        /* √âcran principal du quiz */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-heavy);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Zone de jeu */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-container {
            display: flex;
            gap: 20px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: var(--radius-sm);
            text-align: center;
            min-width: 120px;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-accent);
            border-radius: 6px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Questions */
        .question-container {
            margin-bottom: 40px;
        }

        .question-text {
            font-size: 1.8rem;
            line-height: 1.5;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            border-left: 5px solid var(--primary);
            animation: fadeIn 0.5s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .option.selected {
            background: rgba(74, 111, 255, 0.2);
            border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(74, 111, 255, 0.3);
        }

        .option.correct {
            background: rgba(0, 212, 170, 0.2);
            border-color: var(--accent);
            animation: correctPulse 0.6s;
        }

        .option.incorrect {
            background: rgba(255, 107, 157, 0.2);
            border-color: var(--secondary);
            animation: shake 0.5s;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .option-letter {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-right: 20px;
            flex-shrink: 0;
        }

        .option-text {
            font-size: 1.1rem;
            line-height: 1.4;
        }

        /* Boutons */
        .buttons-container {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px;
        }

        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(74, 111, 255, 0.4);
        }

        .btn-secondary {
            background: var(--gradient-accent);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 212, 170, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: var(--light);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }

        /* R√©sultats */
        .result-container {
            text-align: center;
            padding: 40px;
            animation: zoomIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .result-icon {
            font-size: 8rem;
            margin-bottom: 30px;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        .result-title {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 30px auto;
            position: relative;
        }

        .circle-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }

        .circle-progress {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 565;
            stroke-dashoffset: 565;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            animation: circleFill 1.5s ease-out forwards;
        }

        @keyframes circleFill {
            to { stroke-dashoffset: var(--dash-offset); }
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .result-feedback {
            font-size: 1.3rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 30px auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            border-left: 5px solid var(--accent);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Tableau des scores */
        .leaderboard-container {
            margin-top: 40px;
        }

        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .leaderboard-title {
            font-size: 2rem;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .leaderboard-filters {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn.active {
            background: var(--gradient-primary);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-table thead {
            background: rgba(255, 255, 255, 0.1);
        }

        .leaderboard-table th {
            padding: 20px;
            text-align: left;
            font-weight: 600;
            color: var(--accent);
        }

        .leaderboard-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }

        .leaderboard-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .leaderboard-table tbody tr.current-user {
            background: rgba(74, 111, 255, 0.1);
            border-left: 4px solid var(--primary);
        }

        .leaderboard-table td {
            padding: 20px;
        }

        .rank {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            width: 80px;
        }

        .rank-1 .rank {
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .rank-2 .rank {
            background: var(--gradient-silver);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .rank-3 .rank {
            background: var(--gradient-bronze);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            overflow: hidden;
        }

        .user-avatar-sm img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .user-details p {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
        }

        .badge-display {
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
        }

        .badge-gold {
            background: var(--gradient-gold);
        }

        .badge-silver {
            background: var(--gradient-silver);
        }

        .badge-bronze {
            background: var(--gradient-bronze);
        }

        .badge-platinum {
            background: var(--gradient-accent);
        }

        .date-display {
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .footer-link {
            color: var(--light);
            text-decoration: none;
            opacity: 0.8;
            transition: var(--transition);
        }

        .footer-link:hover {
            opacity: 1;
            color: var(--accent);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(26, 31, 60, 0.95);
            border-radius: var(--radius);
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .user-section {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .btn-nav {
                flex: 1;
                justify-content: center;
            }
            
            .stats-container {
                flex-direction: column;
            }
            
            .stat {
                min-width: auto;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .leaderboard-header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }
            
            .leaderboard-filters {
                width: 100%;
                overflow-x: auto;
            }
        }

        /* Styles pour le timer de 350s */
        .time-format {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 2px;
        }
    </style>
    
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBBn0oSKI3BC6OUW2Tp0QDpR3MkPrwwJ4g",
            authDomain: "syncaura-3bb2c.firebaseapp.com",
            projectId: "syncaura-3bb2c",
            storageBucket: "syncaura-3bb2c.firebasestorage.app",
            messagingSenderId: "318198876674",
            appId: "1:318198876674:web:e716ebc405f86e59ec351b",
            measurementId: "G-VH5BEBDC8R"
        };

        // Initialiser Firebase (version Compat)
        firebase.initializeApp(firebaseConfig);
        
        // Initialiser les services
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Configuration de Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.addScope('profile');
        googleProvider.addScope('email');
        
        console.log("Firebase initialis√© avec succ√®s!");
    </script>
</head>
<body>
    <!-- Spline 3D Background -->
    <div class="spline-background">
        <spline-viewer url="https://prod.spline.design/BK83Flm76SwRJlHz/scene.splinecode"></spline-viewer>
    </div>

    <!-- Overlay sombre pour am√©liorer la lisibilit√© -->
    <div class="background-overlay"></div>

    <!-- Particules d'arri√®re-plan (optionnel) -->
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- En-t√™te avec navigation -->
        <header>
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="logo-text">
                    <h1>SCRUM MASTER PRO</h1>
                    <p>Quiz Certification Agile</p>
                </div>
            </div>
            
            <div class="user-section" id="user-section" style="display: none;">
                <div class="user-profile" id="user-profile">
                    <div class="user-avatar" id="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-name" id="user-name">Invit√©</div>
                    <div class="user-score" id="user-score">Score: 0</div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn-nav active" id="nav-quiz">
                        <i class="fas fa-gamepad"></i> Quiz
                    </button>
                    <button class="btn-nav" id="nav-leaderboard">
                        <i class="fas fa-trophy"></i> Classement
                    </button>
                    <button class="btn-nav" id="nav-profile">
                        <i class="fas fa-user-circle"></i> Profil
                    </button>
                    <button class="btn-nav" id="nav-logout">
                        <i class="fas fa-sign-out-alt"></i> D√©connexion
                    </button>
                </div>
            </div>
        </header>

        <!-- √âcran de connexion -->
        <div class="screen active" id="login-screen">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    
                    <h2 class="login-title">Connexion Requise</h2>
                    <p class="login-subtitle">
                        Connectez-vous pour acc√©der au quiz Scrum Master Pro, sauvegarder vos scores et comparer vos r√©sultats avec d'autres participants.
                    </p>
                    
                    <div class="login-buttons">
                        <button class="btn-login btn-google" id="google-login">
                            <i class="fab fa-google"></i> Se connecter avec Google
                        </button>
                        <button class="btn-login btn-guest" id="guest-login">
                            <i class="fas fa-user"></i> Continuer en tant qu'invit√©
                        </button>
                    </div>
                    
                    <div class="login-features">
                        <h3 style="margin-bottom: 20px; color: var(--accent);">Fonctionnalit√©s d√©bloqu√©es apr√®s connexion:</h3>
                        
                        <div class="feature">
                            <i class="fas fa-trophy"></i>
                            <div>
                                <h4>Tableau des scores</h4>
                                <p>Comparez vos r√©sultats avec d'autres participants</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-chart-line"></i>
                            <div>
                                <h4>Suivi de progression</h4>
                                <p>Visualisez l'√©volution de vos scores au fil du temps</p>
                            </div>
                        </div>
                        
                        <div class="feature">
                            <i class="fas fa-award"></i>
                            <div>
                                <h4>Badges et r√©alisations</h4>
                                <p>D√©bloquez des r√©compenses pour vos performances</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran principal du quiz -->
        <div class="screen" id="quiz-screen">
            <div class="main-content">
                <!-- Zone de jeu -->
                <div class="card game-card">
                    <!-- En-t√™te du jeu -->
                    <div class="game-header">
                        <div class="stats-container">
                            <div class="stat">
                                <div class="stat-value" id="score">0</div>
                                <div class="stat-label">SCORE</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="timer">350</div>
                                <div class="stat-label">TEMPS</div>
                                <div class="time-format" id="time-format">(5:50)</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="question-number">1</div>
                                <div class="stat-label">QUESTION</div>
                            </div>
                        </div>
                        
                        <button class="btn-nav" id="help-btn">
                            <i class="fas fa-question-circle"></i> Aide
                        </button>
                    </div>

                    <!-- Barre de progression -->
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progression du quiz</span>
                            <span id="progress-text">0/15</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                        </div>
                    </div>

                    <!-- Conteneur de question -->
                    <div id="quiz-container" style="display: none;">
                        <div class="question-container">
                            <div class="question-text" id="question-text">
                                Pr√©parez-vous! Le quiz va commencer...
                            </div>
                            
                            <div class="options-grid" id="options-container">
                                <!-- Les options seront g√©n√©r√©es ici -->
                            </div>
                        </div>
                        
                        <div class="buttons-container">
                            <button class="btn btn-outline" id="hint-btn">
                                <i class="fas fa-lightbulb"></i> Indice
                            </button>
                            <button class="btn btn-primary" id="start-quiz-btn">
                                <i class="fas fa-play"></i> Commencer le Quiz
                            </button>
                            <button class="btn btn-primary" id="next-btn" disabled style="display: none;">
                                <i class="fas fa-arrow-right"></i> Question suivante
                            </button>
                        </div>
                    </div>

                    <!-- Conteneur de r√©sultats -->
                    <div class="result-container" id="result-container" style="display: none;">
                        <div class="result-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        
                        <div class="result-title" id="result-title">F√©licitations!</div>
                        
                        <div class="score-circle">
                            <svg width="200" height="200">
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stop-color="#4A6FFF" />
                                        <stop offset="100%" stop-color="#00D4AA" />
                                    </linearGradient>
                                </defs>
                                <circle class="circle-bg" cx="100" cy="100" r="90"/>
                                <circle class="circle-progress" cx="100" cy="100" r="90"/>
                            </svg>
                            <div class="score-text" id="final-score">0%</div>
                        </div>
                        
                        <div class="result-feedback" id="feedback">
                            Votre feedback appara√Ætra ici
                        </div>
                        
                        <div class="buttons-container">
                            <button class="btn btn-outline" id="review-btn">
                                <i class="fas fa-chart-bar"></i> Voir les r√©ponses
                            </button>
                            <button class="btn btn-secondary" id="restart-btn">
                                <i class="fas fa-redo"></i> Rejouer
                            </button>
                            <button class="btn btn-primary" id="share-btn">
                                <i class="fas fa-share-alt"></i> Partager
                            </button>
                        </div>
                    </div>

                    <!-- Message de bienvenue apr√®s connexion -->
                    <div id="welcome-message" style="text-align: center; padding: 50px;">
                        <div style="font-size: 4rem; margin-bottom: 20px; color: var(--accent);">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h2 style="font-size: 2rem; margin-bottom: 20px;">Bienvenue, <span id="welcome-name">Utilisateur</span>!</h2>
                        <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9;">
                            Vous avez 350 secondes (5 minutes et 50 secondes) pour r√©pondre √† 15 questions sur Scrum.
                        </p>
                        <button class="btn btn-primary" id="show-quiz-btn" style="padding: 15px 40px; font-size: 1.2rem;">
                            <i class="fas fa-gamepad"></i> Commencer le Quiz
                        </button>
                    </div>
                </div>

                <!-- Panneau d'information -->
                <div class="card info-panel">
                    <div class="info-header">
                        <div class="info-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div>
                            <h2>Guide Scrum</h2>
                            <p>R√©f√©rence rapide des concepts</p>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-star"></i> Vos Statistiques</h3>
                    <div class="stats-container" style="margin-bottom: 30px;">
                        <div class="stat">
                            <div class="stat-value" id="user-total-score">0</div>
                            <div class="stat-label">SCORE TOTAL</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="user-quizzes">0</div>
                            <div class="stat-label">QUIZ TERMIN√âS</div>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-crown"></i> Votre Meilleur Score</h3>
                    <div class="score-circle" style="width: 150px; height: 150px; margin: 20px auto;">
                        <svg width="150" height="150">
                            <circle class="circle-bg" cx="75" cy="75" r="65"/>
                            <circle class="circle-progress" id="best-score-circle" cx="75" cy="75" r="65"/>
                        </svg>
                        <div class="score-text" style="font-size: 2.5rem;" id="user-best-score">0%</div>
                    </div>
                </div>
            </div>
            
            <!-- Tableau des scores -->
            <div class="leaderboard-container" id="leaderboard-section" style="display: none;">
                <div class="leaderboard-header">
                    <h2 class="leaderboard-title">Tableau des Scores</h2>
                    <div class="leaderboard-filters">
                        <button class="filter-btn active" data-filter="all">Tous les temps</button>
                        <button class="filter-btn" data-filter="month">Ce mois</button>
                        <button class="filter-btn" data-filter="week">Cette semaine</button>
                        <button class="filter-btn" data-filter="today">Aujourd'hui</button>
                    </div>
                </div>
                
                <div class="card">
                    <table class="leaderboard-table" id="leaderboard-table">
                        <thead>
                            <tr>
                                <th style="width: 80px;">Rang</th>
                                <th>Joueur</th>
                                <th style="width: 150px;">Score</th>
                                <th style="width: 150px;">Niveau</th>
                                <th style="width: 200px;">Date</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- Les scores seront charg√©s ici -->
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 50px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 20px;"></i>
                                    <p>Chargement des scores...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>¬© 2023 Scrum Master Pro Quiz. Tous droits r√©serv√©s.</p>
            <p>Quiz certifi√© par des experts Agile | Niveau de difficult√©: Avanc√©</p>
            
            <div class="footer-links">
                <a href="#" class="footer-link"><i class="fas fa-file-certificate"></i> Certification</a>
                <a href="#" class="footer-link"><i class="fas fa-users"></i> Communaut√©</a>
                <a href="#" class="footer-link"><i class="fas fa-download"></i> Ressources</a>
                <a href="#" class="footer-link"><i class="fas fa-envelope"></i> Contact</a>
            </div>
        </footer>
    </div>

    <!-- Modal d'aide -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-help">&times;</button>
            <h2>Comment jouer</h2>
            <p>Bienvenue dans Scrum Master Pro Quiz! Voici comment maximiser votre exp√©rience:</p>
            
            <h3 style="margin-top: 20px;">üìã Instructions du jeu</h3>
            <ul style="margin: 15px 0 25px 20px; line-height: 1.8;">
                <li>Chaque question a <strong>4 options</strong>, une seule est correcte</li>
                <li>Vous avez <strong>350 secondes (5:50)</strong> pour terminer le quiz</li>
                <li>Chaque bonne r√©ponse rapporte <strong>10 points</strong></li>
                <li>Utilisez le bouton "Indice" si vous √™tes bloqu√© (3 max par quiz)</li>
                <li>Atteignez <strong>80%</strong> pour d√©bloquer le badge Expert</li>
            </ul>
            
            <h3>üéØ Objectifs p√©dagogiques</h3>
            <p>Ce quiz couvre les 4 domaines cl√©s de Scrum:</p>
            <ol style="margin: 15px 0 25px 20px; line-height: 1.8;">
                <li>R√¥les et responsabilit√©s</li>
                <li>√âv√©nements et c√©r√©monies</li>
                <li>Artefacts et outils</li>
                <li>Valeurs et principes agiles</li>
            </ol>
        </div>
    </div>

    <!-- Modal de profil -->
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <button class="close-modal" id="close-profile">&times;</button>
            <h2>Votre Profil</h2>
            
            <div style="text-align: center; margin: 30px 0;">
                <div class="user-avatar" id="profile-avatar" style="width: 100px; height: 100px; margin: 0 auto 20px; font-size: 2.5rem;">
                    <i class="fas fa-user"></i>
                </div>
                <h3 id="profile-name">Utilisateur</h3>
                <p id="profile-email" style="opacity: 0.8; margin-bottom: 20px;">email@exemple.com</p>
            </div>
            
            <div class="stats-container" style="justify-content: center; margin-bottom: 30px;">
                <div class="stat">
                    <div class="stat-value" id="profile-total-quizzes">0</div>
                    <div class="stat-label">QUIZ TERMIN√âS</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="profile-best-score">0</div>
                    <div class="stat-label">MEILLEUR SCORE</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="profile-avg-score">0</div>
                    <div class="stat-label">MOYENNE</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 20px;">Historique des scores</h3>
            <div id="score-history" style="max-height: 300px; overflow-y: auto;">
                <!-- L'historique sera charg√© ici -->
                <p style="text-align: center; padding: 20px; opacity: 0.7;">Aucun score enregistr√©</p>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es du quiz
        const quizData = {
            totalQuestions: 15,
            timePerQuiz: 350, // Chang√© de 60 √† 350 secondes
            pointsPerQuestion: 10,
            maxHints: 3,
            questions: [
                {
                    question: "Quelle est la principale diff√©rence entre l'agilit√© et les m√©thodes traditionnelles comme Waterfall?",
                    options: [
                        "L'agilit√© a plus de documentation",
                        "L'agilit√© suit un plan rigide d√®s le d√©but",
                        "L'agilit√© permet des ajustements continus via des cycles it√©ratifs",
                        "L'agilit√© est plus adapt√©e aux projets gouvernementaux"
                    ],
                    correct: 2,
                    hint: "L'agilit√© valorise la capacit√© √† r√©pondre au changement plut√¥t que de suivre un plan fixe.",
                    explanation: "L'agilit√© utilise des cycles courts (sprints) pour s'adapter continuellement, tandis que Waterfall suit une s√©quence lin√©aire rigide."
                },
                {
                    question: "Quel est le r√¥le principal du Product Owner?",
                    options: [
                        "Animer les r√©unions quotidiennes",
                        "Maximiser la valeur du produit via la gestion du Product Backlog",
                        "R√©soudre les blocages techniques",
                        "Assigner les t√¢ches aux d√©veloppeurs"
                    ],
                    correct: 1,
                    hint: "Le Product Owner repr√©sente les int√©r√™ts des parties prenantes et des utilisateurs finaux.",
                    explanation: "Le Product Owner est responsable de maximiser la valeur du produit en g√©rant et priorisant le Product Backlog."
                },
                {
                    question: "Quelle est la dur√©e maximale recommand√©e d'un Sprint selon le Guide Scrum?",
                    options: [
                        "1 semaine",
                        "2 semaines",
                        "1 mois (4 semaines)",
                        "6 semaines"
                    ],
                    correct: 2,
                    hint: "Un Sprint est un conteneur pour tous les autres √©v√©nements Scrum.",
                    explanation: "Un Sprint dure g√©n√©ralement de 1 √† 4 semaines, avec 1 mois comme dur√©e maximale recommand√©e."
                },
                {
                    question: "Quel artefact Scrum montre visuellement le travail restant pendant un Sprint?",
                    options: [
                        "Product Backlog",
                        "Sprint Backlog",
                        "Burndown Chart",
                        "Definition of Ready"
                    ],
                    correct: 2,
                    hint: "Cet artefact aide l'√©quipe √† pr√©dire si elle atteindra l'objectif du Sprint.",
                    explanation: "Le Burndown Chart est un graphique qui montre l'√©volution du travail restant, permettant de visualiser la progression."
                },
                {
                    question: "Parmi ces √©l√©ments, lequel n'est PAS un pilier de Scrum?",
                    options: [
                        "Transparence",
                        "Inspection",
                        "Adaptation",
                        "Planification"
                    ],
                    correct: 3,
                    hint: "Scrum repose sur trois piliers fondamentaux qui soutiennent son empirisme.",
                    explanation: "Les trois piliers de Scrum sont la Transparence, l'Inspection et l'Adaptation."
                },
                {
                    question: "Qui est responsable de la gestion du Sprint Backlog?",
                    options: [
                        "Le Product Owner",
                        "Le Scrum Master",
                        "L'√©quipe de d√©veloppement",
                        "Le chef de projet"
                    ],
                    correct: 2,
                    hint: "C'est un artefact vivant qui peut √™tre ajust√© quotidiennement.",
                    explanation: "L'√©quipe de d√©veloppement est responsable de cr√©er et g√©rer le Sprint Backlog pendant le Sprint."
                },
                {
                    question: "Quel √©v√©nement Scrum a pour but d'inspecter l'incr√©ment et d'adapter le Product Backlog?",
                    options: [
                        "Daily Scrum",
                        "Sprint Planning",
                        "Sprint Review",
                        "Sprint Retrospective"
                    ],
                    correct: 2,
                    hint: "Les parties prenantes sont invit√©es √† participer √† cet √©v√©nement.",
                    explanation: "La Sprint Review a lieu √† la fin du Sprint pour inspecter l'incr√©ment et adapter le Product Backlog."
                },
                {
                    question: "Quelle est la dur√©e maximale recommand√©e du Daily Scrum?",
                    options: [
                        "15 minutes",
                        "30 minutes",
                        "1 heure",
                        "Aucune limite de temps"
                    ],
                    correct: 0,
                    hint: "Cet √©v√©nement est parfois appel√© 'stand-up meeting'.",
                    explanation: "Le Daily Scrum est limit√© √† 15 minutes pour maintenir la focalisation et l'efficacit√©."
                },
                {
                    question: "Quelle affirmation d√©crit le mieux la 'Definition of Done'?",
                    options: [
                        "La date de fin du projet",
                        "Les crit√®res qualit√© que chaque incr√©ment doit respecter",
                        "La liste des participants aux r√©unions",
                        "La description des r√¥les Scrum"
                    ],
                    correct: 1,
                    hint: "Cet accord assure que tout le monde a la m√™me compr√©hension de ce que 'termin√©' signifie.",
                    explanation: "La Definition of Done est un accord sur les crit√®res de qualit√© pour consid√©rer un √©l√©ment comme termin√©."
                },
                {
                    question: "Qui peut annuler un Sprint?",
                    options: [
                        "Seulement le Scrum Master",
                        "Seulement le Product Owner",
                        "Soit le Product Owner, soit l'√©quipe de d√©veloppement",
                        "Seulement le sponsor du projet"
                    ],
                    correct: 1,
                    hint: "Cette d√©cision est g√©n√©ralement prise lorsque l'objectif du Sprint devient obsol√®te.",
                    explanation: "Seul le Product Owner a le pouvoir d'annuler un Sprint, typiquement si l'objectif devient obsol√®te."
                },
                {
                    question: "Quelle est la taille id√©ale d'une √©quipe Scrum selon le Guide Scrum?",
                    options: [
                        "3-5 personnes",
                        "3-9 personnes",
                        "5-11 personnes",
                        "7-13 personnes"
                    ],
                    correct: 1,
                    hint: "Une √©quipe doit √™tre assez petite pour rester agile et assez grande pour terminer un travail significatif.",
                    explanation: "L'√©quipe Scrum id√©ale compte 3-9 membres (d√©veloppeurs + Scrum Master + Product Owner)."
                },
                {
                    question: "Quel est l'objectif principal de la Sprint Retrospective?",
                    options: [
                        "Pr√©senter l'incr√©ment aux parties prenantes",
                        "Planifier le travail du prochain Sprint",
                        "Inspecter le processus Scrum et planifier des am√©liorations",
                        "Synchroniser le travail quotidien"
                    ],
                    correct: 2,
                    hint: "C'est le dernier √©v√©nement du Sprint, avant le prochain Sprint Planning.",
                    explanation: "La Retrospective vise √† inspecter comment le dernier Sprint s'est d√©roul√© et √† planifier des am√©liorations."
                },
                {
                    question: "Quel principe Agile est exprim√© par: 'Les individus et leurs interactions plus que les processus et les outils'?",
                    options: [
                        "Simplicit√©",
                        "Collaboration client",
                        "Communication face-√†-face",
                        "Auto-organisation"
                    ],
                    correct: 2,
                    hint: "C'est le premier principe du Manifeste Agile.",
                    explanation: "Ce principe met l'accent sur la communication directe et les relations humaines dans le d√©veloppement logiciel."
                },
                {
                    question: "Qu'est-ce qu'un 'Spike' en Scrum?",
                    options: [
                        "Une t√¢che technique complexe qui n√©cessite une investigation",
                        "Un diagramme de v√©locit√©",
                        "Une r√©union d'urgence",
                        "Un type de graphique Burndown"
                    ],
                    correct: 0,
                    hint: "Les spikes sont utilis√©s pour r√©duire l'incertitude technique ou fonctionnelle.",
                    explanation: "Un Spike est une t√¢che d'investigation pour explorer une solution ou r√©duire une incertitude."
                },
                {
                    question: "Que mesure la 'V√©locit√©' d'une √©quipe Scrum?",
                    options: [
                        "La vitesse de connexion Internet",
                        "La quantit√© de travail qu'une √©quipe peut traiter pendant un Sprint",
                        "Le temps moyen pour r√©soudre un bug",
                        "Le nombre de r√©unions par semaine"
                    ],
                    correct: 1,
                    hint: "La v√©locit√© est une mesure de capacit√©, pas de productivit√©.",
                    explanation: "La v√©locit√© mesure la quantit√© de travail qu'une √©quipe peut accomplir pendant un Sprint, utilis√©e pour la planification."
                }
            ]
        };

        // Variables d'√©tat
        let currentQuestion = 0;
        let score = 0;
        let timeLeft = quizData.timePerQuiz;
        let timer;
        let gameActive = false;
        let selectedOption = null;
        let hintsUsed = 0;
        let userAnswers = [];
        let currentUser = null;
        let userStats = {
            totalScore: 0,
            quizzesCompleted: 0,
            bestScore: 0,
            averageScore: 0,
            scoresHistory: []
        };

        // √âl√©ments DOM
        const loginScreen = document.getElementById('login-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const userSection = document.getElementById('user-section');
        const userProfile = document.getElementById('user-profile');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const userScoreElement = document.getElementById('user-score');
        const navQuiz = document.getElementById('nav-quiz');
        const navLeaderboard = document.getElementById('nav-leaderboard');
        const navProfile = document.getElementById('nav-profile');
        const navLogout = document.getElementById('nav-logout');
        const googleLoginBtn = document.getElementById('google-login');
        const guestLoginBtn = document.getElementById('guest-login');
        const leaderboardSection = document.getElementById('leaderboard-section');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const leaderboardTable = document.getElementById('leaderboard-table');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const userTotalScore = document.getElementById('user-total-score');
        const userQuizzes = document.getElementById('user-quizzes');
        const userBestScore = document.getElementById('user-best-score');
        const bestScoreCircle = document.getElementById('best-score-circle');
        const helpModal = document.getElementById('help-modal');
        const closeHelp = document.getElementById('close-help');
        const helpBtn = document.getElementById('help-btn');
        const profileModal = document.getElementById('profile-modal');
        const closeProfile = document.getElementById('close-profile');
        const profileName = document.getElementById('profile-name');
        const profileEmail = document.getElementById('profile-email');
        const profileAvatar = document.getElementById('profile-avatar');
        const profileTotalQuizzes = document.getElementById('profile-total-quizzes');
        const profileBestScore = document.getElementById('profile-best-score');
        const profileAvgScore = document.getElementById('profile-avg-score');
        const scoreHistory = document.getElementById('score-history');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const showQuizBtn = document.getElementById('show-quiz-btn');
        const nextButton = document.getElementById('next-btn');
        const hintButton = document.getElementById('hint-btn');
        const restartButton = document.getElementById('restart-btn');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const timeFormatElement = document.getElementById('time-format');
        const questionNumberElement = document.getElementById('question-number');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const quizContainer = document.getElementById('quiz-container');
        const welcomeMessage = document.getElementById('welcome-message');
        const welcomeName = document.getElementById('welcome-name');
        const resultContainer = document.getElementById('result-container');
        const finalScoreElement = document.getElementById('final-score');
        const resultTitle = document.getElementById('result-title');
        const feedbackElement = document.getElementById('feedback');
        const circleProgress = document.querySelector('.circle-progress');
        const reviewBtn = document.getElementById('review-btn');
        const shareBtn = document.getElementById('share-btn');

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', function() {
            initFirebase();
            createParticles();
            setupEventListeners();
            checkAuthState();
            
            // Initialiser l'interface du jeu (mais pas le jeu lui-m√™me)
            initGameUI();
        });

        // Initialiser Firebase
        function initFirebase() {
            console.log("Firebase est pr√™t √† √™tre utilis√©");
            
            // Observer l'√©tat d'authentification
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // Utilisateur connect√©
                    handleUserLogin(user);
                } else {
                    // Utilisateur non connect√©
                    handleUserLogout();
                }
            });
        }

        // Cr√©er des particules d'arri√®re-plan
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30; // R√©duit pour √©viter la surcharge
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                const size = Math.random() * 3 + 1; // Plus petites
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                particle.style.opacity = Math.random() * 0.3 + 0.1; // Plus transparentes
                
                const colors = ['#4A6FFF', '#FF6B9D', '#00D4AA', '#FFD700'];
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                particlesContainer.appendChild(particle);
            }
        }

        // Configurer les √©couteurs d'√©v√©nements
        function setupEventListeners() {
            // Navigation
            navQuiz.addEventListener('click', () => showScreen('quiz'));
            navLeaderboard.addEventListener('click', () => showScreen('leaderboard'));
            navProfile.addEventListener('click', showProfileModal);
            navLogout.addEventListener('click', logoutUser);
            
            // Connexion
            googleLoginBtn.addEventListener('click', loginWithGoogle);
            guestLoginBtn.addEventListener('click', loginAsGuest);
            
            // Filtres du tableau des scores
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    loadLeaderboard(btn.dataset.filter);
                });
            });
            
            // Modals
            helpBtn.addEventListener('click', () => showModal(helpModal));
            closeHelp.addEventListener('click', () => hideModal(helpModal));
            closeProfile.addEventListener('click', () => hideModal(profileModal));
            
            // Fen√™tre modale - fermer en cliquant √† l'ext√©rieur
            window.addEventListener('click', (e) => {
                if (e.target === helpModal) hideModal(helpModal);
                if (e.target === profileModal) hideModal(profileModal);
            });
            
            // Jeu
            startQuizBtn.addEventListener('click', startGame);
            showQuizBtn.addEventListener('click', showQuizInterface);
            nextButton.addEventListener('click', nextQuestion);
            hintButton.addEventListener('click', showHint);
            restartButton.addEventListener('click', restartGame);
            reviewBtn.addEventListener('click', showReview);
            shareBtn.addEventListener('click', shareScore);
        }

        // G√©rer la connexion de l'utilisateur
        async function handleUserLogin(user) {
            currentUser = {
                uid: user.uid,
                displayName: user.displayName || 'Utilisateur',
                email: user.email || '',
                photoURL: user.photoURL || '',
                isGuest: user.isAnonymous || false
            };
            
            // Mettre √† jour l'interface utilisateur
            updateUserUI();
            
            // Charger les statistiques de l'utilisateur
            await loadUserStats();
            
            // Passer √† l'√©cran du quiz
            loginScreen.classList.remove('active');
            quizScreen.classList.add('active');
            userSection.style.display = 'flex';
            
            // Afficher le message de bienvenue
            welcomeMessage.style.display = 'block';
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'none';
            welcomeName.textContent = currentUser.displayName;
            
            // Charger le tableau des scores
            loadLeaderboard('all');
        }

        // G√©rer la d√©connexion de l'utilisateur
        function handleUserLogout() {
            currentUser = null;
            userStats = {
                totalScore: 0,
                quizzesCompleted: 0,
                bestScore: 0,
                averageScore: 0,
                scoresHistory: []
            };
            
            // R√©initialiser l'interface
            loginScreen.classList.add('active');
            quizScreen.classList.remove('active');
            userSection.style.display = 'none';
            
            // R√©initialiser le jeu
            resetGame();
        }

        // Mettre √† jour l'interface utilisateur
        function updateUserUI() {
            if (!currentUser) return;
            
            // Mettre √† jour l'avatar
            if (currentUser.photoURL) {
                userAvatar.innerHTML = `<img src="${currentUser.photoURL}" alt="${currentUser.displayName}">`;
            } else {
                const initials = currentUser.displayName.split(' ').map(n => n[0]).join('').toUpperCase();
                userAvatar.innerHTML = `<span>${initials}</span>`;
            }
            
            // Mettre √† jour le nom
            userName.textContent = currentUser.displayName;
            
            // Mettre √† jour le score
            userScoreElement.textContent = `Score: ${userStats.totalScore}`;
            
            // Mettre √† jour les statistiques
            userTotalScore.textContent = userStats.totalScore;
            userQuizzes.textContent = userStats.quizzesCompleted;
            userBestScore.textContent = `${userStats.bestScore}%`;
            
            // Animer le cercle du meilleur score
            const circumference = 408; // 2 * œÄ * r (r = 65)
            const offset = circumference - (userStats.bestScore / 100) * circumference;
            bestScoreCircle.style.setProperty('--dash-offset', offset);
        }

        // Initialiser l'interface du jeu (sans d√©marrer le jeu)
        function initGameUI() {
            // R√©initialiser les valeurs d'affichage
            scoreElement.textContent = '0';
            timerElement.textContent = quizData.timePerQuiz;
            updateTimeFormat();
            questionNumberElement.textContent = '1';
            progressText.textContent = '0/15';
            progressFill.style.width = '0%';
            
            // Masquer les boutons de jeu
            nextButton.style.display = 'none';
            startQuizBtn.style.display = 'inline-flex';
        }

        // Mettre √† jour le format du temps (mm:ss)
        function updateTimeFormat() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const formattedTime = `(${minutes}:${seconds < 10 ? '0' : ''}${seconds})`;
            if (timeFormatElement) {
                timeFormatElement.textContent = formattedTime;
            }
        }

        // Afficher l'interface du quiz
        function showQuizInterface() {
            welcomeMessage.style.display = 'none';
            quizContainer.style.display = 'block';
            resultContainer.style.display = 'none';
            
            // Pr√©parer la premi√®re question
            questionText.textContent = "Pr√™t √† commencer le quiz? Cliquez sur 'Commencer le Quiz'!";
            optionsContainer.innerHTML = '';
            
            // Afficher le bouton de d√©marrage
            startQuizBtn.style.display = 'inline-flex';
            nextButton.style.display = 'none';
        }

        // Initialiser le jeu (√©tat)
        function initGame() {
            currentQuestion = 0;
            score = 0;
            timeLeft = quizData.timePerQuiz;
            hintsUsed = 0;
            selectedOption = null;
            userAnswers = [];
            gameActive = false;
            
            // Mettre √† jour l'interface
            scoreElement.textContent = score;
            timerElement.textContent = timeLeft;
            updateTimeFormat();
            questionNumberElement.textContent = currentQuestion + 1;
            progressText.textContent = `${currentQuestion + 1}/${quizData.totalQuestions}`;
            progressFill.style.width = '0%';
            
            // Configurer les boutons
            nextButton.disabled = true;
            nextButton.style.opacity = '0.6';
            hintButton.disabled = hintsUsed >= quizData.maxHints;
            
            // Masquer le bouton de d√©marrage, afficher le bouton suivant
            startQuizBtn.style.display = 'none';
            nextButton.style.display = 'inline-flex';
        }

        // D√©marrer le jeu
        function startGame() {
            if (gameActive) return;
            
            initGame();
            gameActive = true;
            loadQuestion();
            startTimer();
        }

        // D√©marrer le timer
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                if (!gameActive) return;
                
                timeLeft--;
                timerElement.textContent = timeLeft;
                updateTimeFormat();
                
                // G√©rer les couleurs et animations selon le temps restant
                if (timeLeft <= 60) { // Moins d'une minute
                    timerElement.style.animation = 'pulse 1s infinite';
                    timerElement.style.color = 'var(--danger)';
                } else if (timeLeft <= 120) { // Moins de 2 minutes
                    timerElement.style.animation = '';
                    timerElement.style.color = 'var(--warning)';
                } else if (timeLeft <= 180) { // Moins de 3 minutes
                    timerElement.style.animation = '';
                    timerElement.style.color = '#FFD700'; // Or
                } else {
                    timerElement.style.animation = '';
                    timerElement.style.color = '';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
        }

        // Charger une question
        function loadQuestion() {
            if (currentQuestion >= quizData.totalQuestions) {
                endGame();
                return;
            }
            
            const question = quizData.questions[currentQuestion];
            questionText.textContent = question.question;
            optionsContainer.innerHTML = '';
            selectedOption = null;
            
            questionNumberElement.textContent = currentQuestion + 1;
            progressText.textContent = `${currentQuestion + 1}/${quizData.totalQuestions}`;
            progressFill.style.width = `${((currentQuestion + 1) / quizData.totalQuestions) * 100}%`;
            
            nextButton.disabled = true;
            nextButton.style.opacity = '0.6';
            hintButton.disabled = hintsUsed >= quizData.maxHints;
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(index, optionElement));
                optionsContainer.appendChild(optionElement);
            });
            
            questionText.style.animation = 'fadeIn 0.5s ease-out';
            setTimeout(() => {
                questionText.style.animation = '';
            }, 500);
        }

        // S√©lectionner une option
        function selectOption(index, element) {
            if (!gameActive || selectedOption !== null) return;
            
            selectedOption = index;
            const question = quizData.questions[currentQuestion];
            
            element.classList.add('selected');
            
            document.querySelectorAll('.option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            nextButton.disabled = false;
            nextButton.style.opacity = '1';
            
            userAnswers.push({
                question: question.question,
                selected: index,
                correct: question.correct,
                explanation: question.explanation
            });
            
            if (index === question.correct) {
                score += quizData.pointsPerQuestion;
                scoreElement.textContent = score;
                element.classList.add('correct');
                
                element.style.animation = 'correctPulse 0.6s';
                setTimeout(() => {
                    element.style.animation = '';
                }, 600);
            } else {
                element.classList.add('incorrect');
                document.querySelectorAll('.option')[question.correct].classList.add('correct');
            }
        }

        // Afficher un indice
        function showHint() {
            if (hintsUsed >= quizData.maxHints) return;
            
            const question = quizData.questions[currentQuestion];
            
            const hintNotification = document.createElement('div');
            hintNotification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--gradient-primary);
                color: white;
                padding: 15px 20px;
                border-radius: var(--radius-sm);
                z-index: 1000;
                max-width: 400px;
                box-shadow: var(--shadow);
                animation: slideInRight 0.5s;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            `;
            
            hintNotification.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 5px;">
                    <i class="fas fa-lightbulb"></i> Indice #${hintsUsed + 1}
                </div>
                <div>${question.hint}</div>
            `;
            
            document.body.appendChild(hintNotification);
            
            setTimeout(() => {
                hintNotification.style.animation = 'slideOutRight 0.5s';
                setTimeout(() => {
                    document.body.removeChild(hintNotification);
                }, 500);
            }, 5000);
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            hintsUsed++;
            hintButton.disabled = hintsUsed >= quizData.maxHints;
        }

        // Question suivante
        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion < quizData.totalQuestions) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        // Terminer le jeu
        function endGame() {
            gameActive = false;
            clearInterval(timer);
            
            const finalScore = Math.min(100, Math.round((score / (quizData.totalQuestions * quizData.pointsPerQuestion)) * 100));
            
            finalScoreElement.textContent = `${finalScore}%`;
            document.getElementById('final-score').textContent = `${finalScore}%`;
            
            const circumference = 565;
            const offset = circumference - (finalScore / 100) * circumference;
            circleProgress.style.setProperty('--dash-offset', offset);
            
            let title = '';
            let feedback = '';
            let badgeClass = '';
            
            if (finalScore >= 90) {
                title = 'Ma√Ætre Scrum!';
                feedback = 'Impressionnant! Votre ma√Ætrise de Scrum est exceptionnelle. Vous avez d√©montr√© une compr√©hension approfondie des principes agiles et des pratiques Scrum.';
                badgeClass = 'badge-gold';
            } else if (finalScore >= 75) {
                title = 'Expert Agile!';
                feedback = 'Excellent travail! Vous ma√Ætrisez les concepts cl√©s de Scrum et comprenez parfaitement l\'esprit agile.';
                badgeClass = 'badge-platinum';
            } else if (finalScore >= 60) {
                title = 'Pratiquant Confirm√©';
                feedback = 'Bon score! Vous avez une solide compr√©hension de Scrum. Continuez √† pratiquer et √† approfondir vos connaissances.';
                badgeClass = 'badge-silver';
            } else if (finalScore >= 40) {
                title = 'Apprenti Agile';
                feedback = 'Vous avez les bases! Scrum prend du temps √† ma√Ætriser. Rejouez pour am√©liorer votre score.';
                badgeClass = 'badge-bronze';
            } else {
                title = 'D√©butant Agile';
                feedback = 'Ne vous d√©couragez pas! Tout le monde commence quelque part. Utilisez ce quiz comme outil d\'apprentissage.';
                badgeClass = 'badge-bronze';
            }
            
            resultTitle.textContent = title;
            feedbackElement.innerHTML = `
                <p>${feedback}</p>
                <div style="margin-top: 15px;">
                    Badge: <span class="badge-display ${badgeClass}" style="margin-left: 10px;">
                        ${finalScore >= 90 ? 'ü•á Ma√Ætre Scrum' : 
                         finalScore >= 75 ? 'üèÖ Expert Agile' : 
                         finalScore >= 60 ? 'üéñÔ∏è Pratiquant Confirm√©' : 
                         'üìö Apprenti Agile'}
                    </span>
                </div>
                <p style="margin-top: 15px; font-size: 1.1rem;">
                    <i class="fas fa-clock"></i> Temps restant: ${timeLeft} secondes
                </p>
            `;
            
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'block';
            resultContainer.style.animation = 'zoomIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            // Sauvegarder le score
            saveUserScore(finalScore);
        }

        // Red√©marrer le jeu
        function restartGame() {
            // Retourner √† l'interface du quiz
            quizContainer.style.display = 'block';
            resultContainer.style.display = 'none';
            
            // R√©initialiser et red√©marrer le jeu
            initGame();
            gameActive = true;
            loadQuestion();
            startTimer();
        }

        // R√©initialiser le jeu
        function resetGame() {
            initGameUI();
        }

        // Connexion avec Google
        async function loginWithGoogle() {
            try {
                console.log("Tentative de connexion Google...");
                const result = await auth.signInWithPopup(googleProvider);
                console.log("‚úÖ Connexion Google r√©ussie:", result.user);
            } catch (error) {
                console.error("‚ùå Erreur de connexion Google:", error);
                alert(`Erreur de connexion: ${error.message}\nCode: ${error.code}`);
            }
        }

        // Connexion en tant qu'invit√©
        async function loginAsGuest() {
            try {
                const result = await auth.signInAnonymously();
                console.log("Connexion invit√© r√©ussie:", result.user);
            } catch (error) {
                console.error("Erreur de connexion invit√©:", error);
                alert(`Erreur de connexion: ${error.message}`);
            }
        }

        // D√©connexion
        async function logoutUser() {
            try {
                await auth.signOut();
                console.log("D√©connexion r√©ussie");
            } catch (error) {
                console.error("Erreur de d√©connexion:", error);
            }
        }

        // V√©rifier l'√©tat d'authentification
        function checkAuthState() {
            const user = auth.currentUser;
            if (user) {
                handleUserLogin(user);
            }
        }

        // Charger les statistiques de l'utilisateur
        async function loadUserStats() {
            if (!currentUser) return;
            
            try {
                const userRef = db.collection('users').doc(currentUser.uid);
                const doc = await userRef.get();
                
                if (doc.exists) {
                    userStats = doc.data();
                } else {
                    // Cr√©er un nouveau document utilisateur
                    userStats = {
                        totalScore: 0,
                        quizzesCompleted: 0,
                        bestScore: 0,
                        averageScore: 0,
                        scoresHistory: [],
                        displayName: currentUser.displayName,
                        email: currentUser.email,
                        photoURL: currentUser.photoURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await userRef.set(userStats);
                }
                
                updateUserUI();
            } catch (error) {
                console.error("Erreur de chargement des statistiques:", error);
            }
        }

        // Sauvegarder le score de l'utilisateur
        async function saveUserScore(finalScore) {
            if (!currentUser || currentUser.isGuest) return;
            
            try {
                const userRef = db.collection('users').doc(currentUser.uid);
                const scoreData = {
                    score: finalScore,
                    date: firebase.firestore.FieldValue.serverTimestamp(),
                    quizId: Date.now().toString()
                };
                
                // Mettre √† jour les statistiques
                const newTotalScore = userStats.totalScore + finalScore;
                const newQuizzesCompleted = userStats.quizzesCompleted + 1;
                const newBestScore = Math.max(userStats.bestScore, finalScore);
                const newAverageScore = Math.round(newTotalScore / newQuizzesCompleted);
                
                const newScoresHistory = [...userStats.scoresHistory, scoreData];
                
                // Limiter l'historique √† 10 entr√©es
                if (newScoresHistory.length > 10) {
                    newScoresHistory.shift();
                }
                
                // Mettre √† jour Firestore
                await userRef.update({
                    totalScore: newTotalScore,
                    quizzesCompleted: newQuizzesCompleted,
                    bestScore: newBestScore,
                    averageScore: newAverageScore,
                    scoresHistory: newScoresHistory,
                    lastPlayed: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Mettre √† jour le tableau des scores
                await saveToLeaderboard(finalScore);
                
                // Mettre √† jour les statistiques locales
                userStats = {
                    ...userStats,
                    totalScore: newTotalScore,
                    quizzesCompleted: newQuizzesCompleted,
                    bestScore: newBestScore,
                    averageScore: newAverageScore,
                    scoresHistory: newScoresHistory
                };
                
                updateUserUI();
                loadLeaderboard('all');
                
            } catch (error) {
                console.error("Erreur de sauvegarde du score:", error);
            }
        }

        // Sauvegarder dans le tableau des scores
        async function saveToLeaderboard(score) {
            if (!currentUser) return;
            
            try {
                await db.collection('leaderboard').add({
                    userId: currentUser.uid,
                    displayName: currentUser.displayName,
                    email: currentUser.email,
                    photoURL: currentUser.photoURL,
                    score: score,
                    date: firebase.firestore.FieldValue.serverTimestamp(),
                    isGuest: currentUser.isGuest || false
                });
                
                console.log("Score ajout√© au tableau des scores");
            } catch (error) {
                console.error("Erreur d'ajout au tableau des scores:", error);
            }
        }

        // Charger le tableau des scores
        async function loadLeaderboard(filter = 'all') {
            if (!leaderboardBody) return;
            
            try {
                let query = db.collection('leaderboard')
                    .orderBy('score', 'desc')
                    .limit(20);
                
                const snapshot = await query.get();
                
                // Afficher les r√©sultats
                leaderboardBody.innerHTML = '';
                
                if (snapshot.empty) {
                    leaderboardBody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 50px;">
                                <i class="fas fa-trophy" style="font-size: 2rem; margin-bottom: 20px; opacity: 0.5;"></i>
                                <p>Aucun score enregistr√©</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let rank = 1;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.date?.toDate() || new Date();
                    const formattedDate = date.toLocaleDateString('fr-FR');
                    
                    // D√©terminer le badge selon le rang
                    let badgeClass = '';
                    if (rank === 1) badgeClass = 'badge-gold';
                    else if (rank === 2) badgeClass = 'badge-silver';
                    else if (rank === 3) badgeClass = 'badge-bronze';
                    else if (data.score >= 80) badgeClass = 'badge-platinum';
                    
                    // D√©terminer la classe de rang
                    let rankClass = '';
                    if (rank <= 3) rankClass = `rank-${rank}`;
                    
                    // V√©rifier si c'est l'utilisateur actuel
                    const isCurrentUser = currentUser && data.userId === currentUser.uid;
                    const userClass = isCurrentUser ? 'current-user' : '';
                    
                    const row = document.createElement('tr');
                    row.className = `${rankClass} ${userClass}`;
                    row.innerHTML = `
                        <td class="rank">${rank}</td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar-sm">
                                    ${data.photoURL ? 
                                        `<img src="${data.photoURL}" alt="${data.displayName}">` : 
                                        `<span>${data.displayName?.charAt(0).toUpperCase() || 'U'}</span>`
                                    }
                                </div>
                                <div class="user-details">
                                    <h4>${data.displayName || 'Utilisateur'} ${data.isGuest ? '(Invit√©)' : ''}</h4>
                                    <p>${data.email || ''}</p>
                                </div>
                            </div>
                        </td>
                        <td class="score-display">${data.score}%</td>
                        <td>
                            ${badgeClass ? 
                                `<div class="badge-display ${badgeClass}">
                                    ${rank === 1 ? 'ü•á Or' : 
                                     rank === 2 ? 'ü•à Argent' : 
                                     rank === 3 ? 'ü•â Bronze' : 
                                     'üèÖ Expert'}
                                </div>` : 
                                '<div style="opacity: 0.7;">Participant</div>'
                            }
                        </td>
                        <td class="date-display">${formattedDate}</td>
                    `;
                    
                    leaderboardBody.appendChild(row);
                    rank++;
                });
                
            } catch (error) {
                console.error("Erreur de chargement du tableau des scores:", error);
                leaderboardBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 50px; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 20px;"></i>
                            <p>Erreur de chargement des scores</p>
                        </td>
                    </tr>
                `;
            }
        }

        // Afficher un √©cran sp√©cifique
        function showScreen(screen) {
            // Mettre √† jour la navigation active
            [navQuiz, navLeaderboard].forEach(btn => btn.classList.remove('active'));
            
            if (screen === 'quiz') {
                navQuiz.classList.add('active');
                leaderboardSection.style.display = 'none';
            } else if (screen === 'leaderboard') {
                navLeaderboard.classList.add('active');
                leaderboardSection.style.display = 'block';
                loadLeaderboard('all');
            }
        }

        // Afficher le modal de profil
        async function showProfileModal() {
            if (!currentUser) return;
            
            // Mettre √† jour les informations du profil
            profileName.textContent = currentUser.displayName;
            profileEmail.textContent = currentUser.email || 'Non sp√©cifi√©';
            
            if (currentUser.photoURL) {
                profileAvatar.innerHTML = `<img src="${currentUser.photoURL}" alt="${currentUser.displayName}">`;
            } else {
                const initials = currentUser.displayName.split(' ').map(n => n[0]).join('').toUpperCase();
                profileAvatar.innerHTML = `<span style="font-size: 2rem;">${initials}</span>`;
            }
            
            // Mettre √† jour les statistiques
            profileTotalQuizzes.textContent = userStats.quizzesCompleted;
            profileBestScore.textContent = userStats.bestScore;
            profileAvgScore.textContent = userStats.averageScore;
            
            // Afficher l'historique des scores
            scoreHistory.innerHTML = '';
            
            if (userStats.scoresHistory.length === 0) {
                scoreHistory.innerHTML = '<p style="text-align: center; padding: 20px; opacity: 0.7;">Aucun score enregistr√©</p>';
            } else {
                userStats.scoresHistory.reverse().forEach((scoreData, index) => {
                    const date = scoreData.date?.toDate() || new Date();
                    const formattedDate = date.toLocaleDateString('fr-FR');
                    
                    const scoreItem = document.createElement('div');
                    scoreItem.className = 'feature';
                    scoreItem.style.marginBottom = '10px';
                    scoreItem.innerHTML = `
                        <i class="fas fa-chart-line" style="color: ${scoreData.score >= 80 ? 'var(--accent)' : 
                            scoreData.score >= 60 ? 'var(--primary)' : 'var(--secondary)'}"></i>
                        <div style="flex: 1;">
                            <h4>Score: ${scoreData.score}%</h4>
                            <p>${formattedDate}</p>
                        </div>
                        <div style="font-weight: 600; color: var(--accent);">
                            ${scoreData.score >= 80 ? 'Excellent!' : 
                              scoreData.score >= 60 ? 'Bon' : 
                              '√Ä am√©liorer'}
                        </div>
                    `;
                    scoreHistory.appendChild(scoreItem);
                });
            }
            
            showModal(profileModal);
        }

        // Afficher/masquer un modal
        function showModal(modal) {
            modal.classList.add('active');
        }

        function hideModal(modal) {
            modal.classList.remove('active');
        }

        // Afficher la revue des r√©ponses
        function showReview() {
            alert("Cette fonctionnalit√© afficherait un r√©capitulatif de toutes vos r√©ponses. √Ä impl√©menter!");
        }

        // Partager le score
        function shareScore() {
            const finalScore = document.getElementById('final-score').textContent;
            const text = `J'ai obtenu ${finalScore} au quiz Scrum Master Pro! Testez vos connaissances: ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Mon score Scrum Master Pro',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert("Score copi√© dans le presse-papier!");
                });
            }
        }
    </script>
     <script>
        const splineViewer = document.querySelector('spline-viewer');
        document.addEventListener('mousemove', (event) => {
            const { innerWidth, innerHeight } = window;
            const x = (event.clientX / innerWidth) * 2 - 1; 
            const y = -(event.clientY / innerHeight) * 2 + 1; 
            const rotationSpeed = 1; 
            splineViewer.camera.rotation.x = y * rotationSpeed;
            splineViewer.camera.rotation.y = x * rotationSpeed;
        });

        window.onload = function() {
            var shadowRoot = document.querySelector('spline-viewer').shadowRoot;
            shadowRoot.querySelector('#logo').remove();
        }
    </script>
</body>
</html>

